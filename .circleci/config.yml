version: 2

references:

  install_backend_dependencies: &install_backend_dependencies
    run:
      name: Install backend dependencies
      command: |
        cd server
        pipenv install
jobs:
  build:
    docker:
      - image: circleci/python:3.7.3
    steps:
      - checkout
      - *install_backend_dependencies
      - run: sudo apt-get update && sudo apt-get -y install postgresql
      - run: sudo su - postgres
        - run: psql -c 'CREATE DATABASE mentionscrawler;'
        - run: cd server && pipenv run python -m unittest discover -s test -p '*_test.py'

